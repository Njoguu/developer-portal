openapi: 3.0.0

info:

  title: 'APIs.io API'
  description: 'This is the public version of the APis.io API search engine, providing search and submission capabilities.'
  version: V1

  contact:
    name: Kin Lane
    email: info@apievangelist.com

servers:
  - url: https://dqkupdnj9l.execute-api.us-east-1.amazonaws.com/staging    

tags:

  - name: APIs
    description: An API index as defined by APIs.json
  - name: Engines
    description: The engine of an API search engine.  
  - name: Search
    description: Searching for API related resources.
  - name: Maintainers
    description: Searching for maintainers of APIs. 
  - name: Properties
    description: Searching for properties of APIs.     
  - name: Tags
    description: Searching for APIs by tags.    

paths:

  /search/engines/apis:

    get:
      operationId: searchIndex
      summary: Search API Index
      description: 'Search across all APIs in the index.'
      parameters:

        - name: search
          description: 'Searching all APIs.'        
          in: query
          required: false
          schema:
            type: string
        - name: type
          description: 'Searching all APIs.'        
          in: query
          required: false
          schema:
            type: string  
        - name: maintainer
          description: 'Searching all APIs.'        
          in: query
          required: false
          schema:
            type: string                        
        - name: limit
          in: query
          required: false
          schema:
            type: string
        - name: page
          in: query
          required: false
          schema:
            type: string

      tags:
        - APIs
        - Search
        - Engine

      responses:
        "200":
          description: Success
          headers:
            Access-Control-Allow-Origin:
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Search"
 
    post:
      summary: Submit API
      description: 'Submit an API to be included in the index.'
      operationId: addAPI
      tags:
        - APIs
      requestBody:
        $ref: "#/components/requestBodies/API"
      responses:
        "201":
          description: 201 response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/apisjson"
      security:
        - api_key: []


  /search/engines/apis/latest:

    get:
      operationId: getLatestAPIsJSON
      summary: Latest APIs.json
      description: 'This returns a list of APIs which have not been updated within the last week.'

      tags:
        - APIs
        - Search
        - Engines
        - Latest

      responses:
        "200":
          description: Success
          headers:
            Access-Control-Allow-Origin:
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Search"  

    put:
      operationId: processesLatestAPIsJSON
      summary: 'Process Latest APIs.json'
      description: 'Pulls the latest APIs.json that has not been pulled within the last week.'
      tags:
        - APIs
        - Search
        - Engines  

      responses:
        "200":
          description: Success
          headers:
            Access-Control-Allow-Origin:
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Search"

  /search/engines/apis/properties/latest:

    get:
      operationId: getLatestAPIsJSONProperties
      summary: Latest APIs.json Properties
      description: 'This returns a list of APIs.json properties which have not been updated within the last week.'

      tags:
        - APIs
        - Search
        - Engines
        - Properties
        - Latest

      responses:
        "200":
          description: Success
          headers:
            Access-Control-Allow-Origin:
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Search"  

    put:
      operationId: processesLatestAPIsJSONProperties
      summary: 'Process Latest APIs.json Properties'
      description: 'Pulls the latest APIs.json Properties that has not been pulled within the last week.'
      tags:
        - APIs
        - Search
        - Engines  

      responses:
        "200":
          description: Success
          headers:
            Access-Control-Allow-Origin:
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Search"

  /search/engines/apis/rules:

    get:
      operationId: getRulesRunAgainstAPI
      summary: Get Rules Run Against APIs
      description: 'This pulls a list of rules and detail of last run against any API'

      tags:
        - APIs
        - Search
        - Engines
        - Rules

      responses:
        "200":
          description: Success
            application/json:
              schema:
                $ref: "#/components/schemas/Search"  

    put:
      operationId: runRulesAgainstAPIsJSON
      summary: 'Runs Rules Against APIs.jso'
      description: 'Runs all the rules against an APIs.json file.'
      tags:
        - APIs
        - Search
        - Engines  
        - Rules

      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Search"                

  /search/engines/apis/properties/rules:

    get:
      operationId: getRulesRunAgainstAPIProperties
      summary: Get Rules Run Against API Properties
      description: 'This pulls a list of rules and detail of last run against API properties.'

      tags:
        - APIs
        - Search
        - Engines
        - Properties
        - Rules

      responses:
        "200":
          description: Success
            application/json:
              schema:
                $ref: "#/components/schemas/Search"  

    put:
      operationId: runRulesAgainstAPIsJSONProperties
      summary: 'Runs Rules Against APIs.json Properties'
      description: 'Runs all the rules against an APIs.json properties.'
      tags:
        - APIs
        - Search
        - Engines  
        - Properties
        - Rules

      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Search" 

components:

  requestBodies:

    API:
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/API"
      required: true
  
  securitySchemes:
    api_key:
      type: apiKey
      name: x-api-key
      in: header
  
  schemas:

    # Search object used across apis, properties, maintainers, and tag search.
    Search:
      type: object
      description: 'An JSON API object with metadata, data, and links.'
      properties:
        meta:
          type: object
          properties:
            search:
              type: string
            type:
              type: string    
            limit:
              type: integer 
            page:
              type: integer    
            totalPages:
              type: integer                                                 
          required:
           - totalPages
           - page
           - limit
        data:
          type: array
          items:
            "$ref": "#/components/schemas/API"
          description: 'Listing of APIs in the JSON API format.'
        links:
          type: object
          properties:
            self:
              type: string
            first:
              type: string
            prev:
              type: string
            next:
              type: string
            last:
              type: string
          required:
          - self
      required:
      - meta
      - data
      - links

    # Top level APIs.json object.
    API:
      type: object
      required:
      - url
      
      properties:
      
        name:
          type: string
          description: The name of the service described
          minLength: 5

        description:
          type: string
          description: Description of the service
          minLength: 5

        url:
          type: string
          description: URL where the apis.json file will live
          pattern: "^(http)|(https)://(.*)$"

        image:
          type: string
          description: Image to represent the API

        created:
          type: string
          format: date
          description: Date when the file was created

        modified:
          type: string
          format: date
          description: Date when the file was modified

        specificationVersion:
          type: string
          description: APIs.json spec version, latest is 0.14

        tags:
          type: array
          items:
            "$ref": "#/components/schemas/tags"
          description: Tags to describe the service

    tags:
      description: A consistent set of tag to apply to a description          